# Load the necessary libraries
library(MatchIt)

# Generate sample data
set.seed(123) # for reproducibility
n <- 1000 # total number of subjects
age <- round(rnorm(n, mean = 40, sd = 10)) # generate age data
race <- sample(c("White", "Black", "Asian", "Hispanic"), size = n, replace = TRUE) # generate race data
gender <- sample(c("Male", "Female"), size = n, replace = TRUE) # generate gender data
group <- sample(c("Control", "Patient"), size = n, replace = TRUE, prob = c(0.5, 0.5)) # generate group data
y <- rnorm(n) # generate outcome variable

# Create data frame
df <- data.frame(age, race, gender, group, y)

# Create a formula for the propensity score model
ps_formula <- formula("group ~ age + race + gender")

# Fit the propensity score model
ps_model <- glm(ps_formula, data = df, family = binomial(link = "logit"))

# Extract the propensity scores
ps <- ps_model$fitted.values

# Perform matching
matched_data <- matchit(group ~ age + race + gender, data = df, method = "nearest", distance = "logit", ratio = 1, caliper = 0.2, replace = FALSE)

# Extract the matched data
matched_df <- match.data(matched_data)

# Check the results
summary(matched_df$group)
summary(matched_df$race)
summary(matched_df$gender)
summary(matched_df$age)

